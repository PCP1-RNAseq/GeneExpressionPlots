(()=>{(function(){"use strict";var an=function(){return function(n){n=n||{};var n=typeof n!="undefined"?n:{},i,a;n.ready=new Promise(function(e,t){i=e,a=t});var r={},o;for(o in n)n.hasOwnProperty(o)&&(r[o]=n[o]);var c=!0,s="",y;typeof document!="undefined"&&document.currentScript&&(s=document.currentScript.src),s.indexOf("blob:")!==0?s=s.substr(0,s.lastIndexOf("/")+1):s="";var p=n.print||console.log.bind(console),b=n.printErr||console.warn.bind(console);for(o in r)r.hasOwnProperty(o)&&(n[o]=r[o]);r=null,n.arguments,n.thisProgram,n.quit;var m;n.wasmBinary&&(m=n.wasmBinary),n.noExitRuntime,typeof WebAssembly!="object"&&V("no native wasm support detected");var E,T=!1;function x(e,t){e||V("Assertion failed: "+t)}function d(e){var t=n["_"+e];return x(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function W(e,t,f,v,w){var h={string:function(_){var S=0;if(_!=null&&_!==0){var sn=(_.length<<2)+1;S=$(sn),yn(_,S,sn)}return S},array:function(_){var S=$(_.length);return gn(_,S),S}};function l(_){return t==="string"?Y(_):t==="boolean"?Boolean(_):_}var u=d(e),g=[],P=0;if(v)for(var I=0;I<v.length;I++){var rn=h[f[I]];rn?(P===0&&(P=en()),g[I]=rn(v[I])):g[I]=v[I]}var B=u.apply(null,g);return B=l(B),P!==0&&tn(P),B}function hn(e,t,f,v){f=f||[];var w=f.every(function(l){return l==="number"}),h=t!=="string";return h&&w&&!v?d(e):function(){return W(e,t,f,arguments)}}var q=typeof TextDecoder!="undefined"?new TextDecoder("utf8"):void 0;function X(e,t,f){for(var v=t+f,w=t;e[w]&&!(w>=v);)++w;if(w-t>16&&e.subarray&&q)return q.decode(e.subarray(t,w));for(var h="";t<w;){var l=e[t++];if(!(l&128)){h+=String.fromCharCode(l);continue}var u=e[t++]&63;if((l&224)==192){h+=String.fromCharCode((l&31)<<6|u);continue}var g=e[t++]&63;if((l&240)==224?l=(l&15)<<12|u<<6|g:l=(l&7)<<18|u<<12|g<<6|e[t++]&63,l<65536)h+=String.fromCharCode(l);else{var P=l-65536;h+=String.fromCharCode(55296|P>>10,56320|P&1023)}}return h}function Y(e,t){return e?X(O,e,t):""}function bn(e,t,f,v){if(!(v>0))return 0;for(var w=f,h=f+v-1,l=0;l<e.length;++l){var u=e.charCodeAt(l);if(u>=55296&&u<=57343){var g=e.charCodeAt(++l);u=65536+((u&1023)<<10)|g&1023}if(u<=127){if(f>=h)break;t[f++]=u}else if(u<=2047){if(f+1>=h)break;t[f++]=192|u>>6,t[f++]=128|u&63}else if(u<=65535){if(f+2>=h)break;t[f++]=224|u>>12,t[f++]=128|u>>6&63,t[f++]=128|u&63}else{if(f+3>=h)break;t[f++]=240|u>>18,t[f++]=128|u>>12&63,t[f++]=128|u>>6&63,t[f++]=128|u&63}}return t[f]=0,f-w}function yn(e,t,f){return bn(e,O,t,f)}typeof TextDecoder!="undefined"&&new TextDecoder("utf-16le");function gn(e,t){J.set(e,t)}var J,O,F;function vn(e){n.HEAP8=J=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAP32=F=new Int32Array(e),n.HEAPU8=O=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=new Float64Array(e)}n.INITIAL_MEMORY;var k,K=[],Q=[],Z=[];function wn(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Rn(n.preRun.shift());U(K)}function En(){U(Q)}function _n(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)An(n.postRun.shift());U(Z)}function Rn(e){K.unshift(e)}function Tn(e){Q.unshift(e)}function An(e){Z.unshift(e)}var A=0,C=null;function Pn(e){A++,n.monitorRunDependencies&&n.monitorRunDependencies(A)}function In(e){if(A--,n.monitorRunDependencies&&n.monitorRunDependencies(A),A==0&&C){var t=C;C=null,t()}}n.preloadedImages={},n.preloadedAudios={};function V(e){n.onAbort&&n.onAbort(e),e+="",b(e),T=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw a(t),t}var dn="data:application/octet-stream;base64,";function Sn(e){return e.startsWith(dn)}var R;({VITE_APP_TITLE:"PCP1-RNAseq-GXP",VITE_PRELOAD_DATA:"/GeneExpressionPlots/expression_table.txt",VITE_PRELOAD_IMAGE:"",VITE_PRELOAD_INFO:"/GeneExpressionPlots/info_table.txt",VITE_PRELOAD_SETTINGS:"/GeneExpressionPlots/GXP_settings.json",VITE_PRELOAD_PLOTS:"",VITE_PRELOAD_ENRICHMENTS:"",BASE_URL:"/GeneExpressionPlots/",MODE:"production",DEV:!1,PROD:!0}===void 0)?R="/public/gsl.wasm":R="/GeneExpressionPlots/gsl.wasm";function M(e){try{if(e==R&&m)return new Uint8Array(m);if(!y)throw"both async and sync fetching of the wasm failed"}catch(t){V(t)}}function xn(){return!m&&c&&typeof fetch=="function"?fetch(R,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+R+"'";return e.arrayBuffer()}).catch(function(){return M(R)}):Promise.resolve().then(function(){return M(R)})}function On(){var e={env:nn,wasi_snapshot_preview1:nn};function t(l,u){var g=l.exports;n.asm=g,E=n.asm.memory,vn(E.buffer),k=n.asm.__indirect_function_table,Tn(n.asm.__wasm_call_ctors),In()}Pn();function f(l){t(l.instance)}function v(l){return xn().then(function(u){var g=WebAssembly.instantiate(u,e);return g}).then(l,function(u){b("failed to asynchronously prepare wasm: "+u),V(u)})}function w(){return!m&&typeof WebAssembly.instantiateStreaming=="function"&&!Sn(R)&&typeof fetch=="function"?fetch(R,{credentials:"same-origin"}).then(function(l){var u=WebAssembly.instantiateStreaming(l,e);return u.then(f,function(g){return b("wasm streaming compile failed: "+g),b("falling back to ArrayBuffer instantiation"),v(f)})}):v(f)}if(n.instantiateWasm)try{var h=n.instantiateWasm(e,t);return h}catch(l){return b("Module.instantiateWasm callback failed with error: "+l),!1}return w().catch(a),{}}function U(e){for(;e.length>0;){var t=e.shift();if(typeof t=="function"){t(n);continue}var f=t.func;typeof f=="number"?t.arg===void 0?k.get(f)():k.get(f)(t.arg):f(t.arg===void 0?null:t.arg)}}function Fn(){V()}function Cn(e,t,f){O.copyWithin(e,t,t+f)}var D={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var f=D.buffers[e];t===0||t===10?((e===1?p:b)(X(f,0)),f.length=0):f.push(t)},varargs:void 0,get:function(){D.varargs+=4;var e=F[D.varargs-4>>2];return e},getStr:function(e){var t=Y(e);return t},get64:function(e,t){return e}};function Vn(e){return 0}function jn(e,t,f,v,w){}function Dn(e,t,f,v){for(var w=0,h=0;h<f;h++){for(var l=F[t+h*8>>2],u=F[t+(h*8+4)>>2],g=0;g<u;g++)D.printChar(e,O[l+g]);w+=u}return F[v>>2]=w,0}function Nn(e){}var nn={abort:Fn,emscripten_memcpy_big:Cn,fd_close:Vn,fd_seek:jn,fd_write:Dn,setTempRet0:Nn};On(),n.___wasm_call_ctors=function(){return(n.___wasm_call_ctors=n.asm.__wasm_call_ctors).apply(null,arguments)},n._gsl_ran_hypergeometric_pdf=function(){return(n._gsl_ran_hypergeometric_pdf=n.asm.gsl_ran_hypergeometric_pdf).apply(null,arguments)},n.___errno_location=function(){return(n.___errno_location=n.asm.__errno_location).apply(null,arguments)};var en=n.stackSave=function(){return(en=n.stackSave=n.asm.stackSave).apply(null,arguments)},tn=n.stackRestore=function(){return(tn=n.stackRestore=n.asm.stackRestore).apply(null,arguments)},$=n.stackAlloc=function(){return($=n.stackAlloc=n.asm.stackAlloc).apply(null,arguments)};n.dynCall_jiji=function(){return(n.dynCall_jiji=n.asm.dynCall_jiji).apply(null,arguments)},n.ccall=W,n.cwrap=hn;var N;C=function e(){N||z(),N||(C=e)};function z(e){if(A>0||(wn(),A>0))return;function t(){N||(N=!0,n.calledRun=!0,!T&&(En(),i(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),_n()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),t()},1)):t()}if(n.run=z,n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return z(),n.ready}}();const cn=an();function H(n,i,a,r,o){const c=[n+o,i-o,a-o,r+o];if(c.findIndex(s=>s<0)===-1)return c}function L(n,i,a,r){return cn.then(o=>o._gsl_ran_hypergeometric_pdf(n,n+i,a+r,n+a))}async function fn(n,i,a,r){const o=[n,i,a,r];if(o.findIndex(m=>m<0)!==-1)throw new Error("Negative numbers are not supported.");if(o.findIndex(m=>!Number.isInteger(m))!==-1)throw new Error("Only positive integers are supported.");let c=0,s=[n,i,a,r];do{const m=await L(s[0],s[1],s[2],s[3]);if(m===0)break;c+=m,s=H(s[0],s[1],s[2],s[3],-1)}while(s!==void 0);let y=0;s=[n,i,a,r];do{const m=await L(s[0],s[1],s[2],s[3]);if(m===0)break;y+=m,s=H(s[0],s[1],s[2],s[3],1)}while(s!==void 0);const p=Math.min(c,y),b=Math.min(p*2,1);return{leftPValue:c,rightPValue:y,oneTailedPValue:p,twoTailedPValue:b}}function on(n){const i=n.length,a=n.map((c,s)=>[c,s]);a.sort((c,s)=>c[0]-s[0]);const r=n.slice();let o=Number.MAX_VALUE;for(let c=i-1;c>=0;c--){const[s,y]=a[c],p=Math.min(s*i/(c+1),1);p<o&&(o=p),r[y]=p,c<i-1&&r[y]>o&&(r[y]=o)}return r}function j(n,i){if(n.constructor.name!=="Set"||i.constructor.name!=="Set")throw Error(`Arguments must be of class 'Set', but a is an ${n.constructor.name} and b is an ${i.constructor.name}`);const a=[...n];return new Set(a.filter(r=>i.has(r)))}function G(n,i,a,r,o){const c=[j(n,a).size,j(i,a).size,j(r,n).size,j(r,i).size];if(o){const s=[],y=c.reduce((x,d)=>x+d),p=new Set([...n,...i,...a,...r]).size;y!==p&&s.push(`Contingency table sums up to ${y}, but universe has (arguments union to a set of) ${p} elements. This number must be identical.`);const b=c[0]+c[2];b!==n.size&&s.push(`${n.size} elements have trait 'A', but contingency table's first column sums to ${b}. Numbers must be equal.`);const m=c[0]+c[1];m!==n.size&&s.push(`${n.size} elements have trait 'B', but contingency table's first row sums to ${m}. Numbers must be equal.`);const E=c[1]+c[3];E!==i.size&&s.push(`${i.size} elements have trait 'A', but contingency table's second column sums to ${E}. Numbers must be equal.`);const T=c[2]+c[3];if(T!==i.size&&s.push(`${i.size} elements have trait 'B', but contingency table's second row sums to ${T}. Numbers must be equal.`),s.length>0)throw Error(s.join(" "))}return c}function un(n,i){switch(n){case"<":return a=>Object.entries(a).filter(r=>parseFloat(r[1])<parseFloat(i)).map(r=>r[0]);case">":return a=>Object.entries(a).filter(r=>parseFloat(r[1])>parseFloat(i)).map(r=>r[0]);case"<=":return a=>Object.entries(a).filter(r=>parseFloat(r[1])<=parseFloat(i)).map(r=>r[0]);case">=":return a=>Object.entries(a).filter(r=>Math.abs(parseFloat(r[1]))>=Math.abs(parseFloat(i))).map(r=>r[0]);case"abs >=":return a=>Object.entries(a).filter(r=>Math.abs(parseFloat(r[1]))>=Math.abs(parseFloat(i))).map(r=>r[0]);case"abs <=":return a=>Object.entries(a).filter(r=>Math.abs(parseFloat(r[1]))<=Math.abs(parseFloat(i))).map(r=>r[0]);case"abs >":return a=>Object.entries(a).filter(r=>Math.abs(parseFloat(r[1]))>Math.abs(parseFloat(i))).map(r=>r[0]);case"abs <":return a=>Object.entries(a).filter(r=>Math.abs(parseFloat(r[1]))<Math.abs(parseFloat(i))).map(r=>r[0]);case"==":return a=>Object.entries(a).filter(r=>r[1]==i).map(r=>r[0]);case"regexp":return a=>Object.entries(a).filter(r=>{const o=new RegExp(i);return!!r[1].match(o)}).map(r=>r[0]);default:throw new Error(`unsupported selector ${n}`)}}async function ln(n){return await fn(n[0],n[1],n[2],n[3])}async function mn(n,i){const a=[],r=[];return await Promise.all(Object.entries(n).map(async([c,s])=>{if(c&&c!==""&&c!=="NA"){const p=(await ln(s)).rightPValue;r.push(p);const b=i?[c,i[c],p]:[c,p];a.push(b)}})),on(r).forEach((c,s)=>{a[s].push(c)}),a}function pn(n,i,a,r,o){switch(o.TEIselectorType){case"binary":{const c=un(o.TEIselector,o.TEIselectorValue),s=new Set(c(r)),y=new Set(n.filter(m=>!s.has(m))),p=`${o.TEIcolumn} ${o.TEIselector} ${o.TEIselectorValue}`,b=G(i,a,s,y);return{[p]:b}}case"multinomial":{const c={};let s=[];return Object.entries(r).forEach(([p,b])=>{var m;if(o.TEIselector==="delimiter")s=b.split(o.TEIselectorValue);else if(o.TEFselector==="regexp"){const E=new RegExp(o.TEIselectorValue,"g");s=(m=b.match(E))!=null?m:[]}s&&s.forEach(E=>{Array.isArray(c[E])?c[E].push(p):c[E]=[p]})}),Object.entries(c).reduce((p,[b,m])=>{if(m.some(E=>i.has(E))){const E=new Set(m),T=new Set(n.filter(d=>!E.has(d))),x=G(i,a,E,T);p[b]=x}return p},{})}default:throw new Error(`unsupported selector type ${o.TEIselectorType}`)}}onmessage=async function(n){const{geneIdsTEFpos:i,geneIdsTEFneg:a,TEIpayload:r,TEIdescriptions:o,options:c}=n.data,s=[...i,...a],y=pn(s,i,a,r,c),p=await mn(y,o);postMessage(p.sort(),void 0)}})();})();
